name: Matrix Strategy Avanzado

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:  # Permite ejecución manual

jobs:
  test-matrix:
    name: Tests en ${{ matrix.os }} (Node ${{ matrix.node }})
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node: [16, 18, 20]
        include:
          # Configuraciones especiales
          - os: ubuntu-latest
            node: 20
            experimental: true
        exclude:
          # Excluir Node 16 en Windows
          - os: windows-latest
            node: 16

    runs-on: ${{ matrix.os }}
    continue-on-error: ${{ matrix.experimental || false }}

    steps:
      - name: Checkout del código
        uses: actions/checkout@v3

      - name: Configurar Node.js ${{ matrix.node }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
          cache: 'npm'

      - name: Instalar dependencias
        run: npm ci  # Usa npm ci para instalación limpia (requiere package-lock.json)

      - name: Ejecutar tests
        run: npm test

      - name: Verificar si es experimental
        if: matrix.experimental
        run: echo "⚠️ Esta es una configuración experimental (Ubuntu + Node 20)"